# AX2 Caption 프로덕션 아키텍처

회사 공식 서비스로 운영하기 위한 전체 시스템 아키텍처입니다.

---

## 🏗️ 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        사용자 (브라우저)                      │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        │ HTTPS
                        │
┌───────────────────────▼─────────────────────────────────────┐
│                      Nginx (리버스 프록시)                     │
│  - SSL/TLS 종료                                              │
│  - 정적 파일 서빙                                            │
│  - 로드 밸런싱                                               │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        │
        ┌───────────────┴───────────────┐
        │                               │
┌───────▼────────┐            ┌────────▼────────┐
│  API Server 1  │            │  API Server 2   │
│  (Node.js)     │            │  (Node.js)       │
│  Port: 3000    │            │  Port: 3001     │
└───────┬────────┘            └────────┬────────┘
        │                               │
        └───────────────┬───────────────┘
                        │
        ┌───────────────▼───────────────┐
        │     PostgreSQL (Master)      │
        │  - 사용자 데이터              │
        │  - 작업 데이터                │
        │  - 크레딧 데이터              │
        └───────────────┬───────────────┘
                        │
        ┌───────────────▼───────────────┐
        │   PostgreSQL (Replica)        │
        │  - 읽기 전용 복제             │
        └───────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    파일 스토리지                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Local FS    │  │  AWS S3     │  │  CDN         │      │
│  │  (임시)      │  │  (영구)     │  │  (배포)      │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    외부 서비스                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  AI 서비스   │  │  결제 PG사   │  │  모니터링    │      │
│  │  (STT/번역)  │  │  (토스 등)   │  │  (Sentry)    │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

---

## 📦 컴포넌트 설명

### 1. 프론트엔드
- **기술**: HTML5, CSS3, Vanilla JavaScript
- **호스팅**: Nginx 또는 CDN
- **배포**: 정적 파일 배포

### 2. API 서버
- **기술**: Node.js, Express
- **프로세스 관리**: PM2
- **스케일링**: 수평 확장 (로드 밸런서)

### 3. 데이터베이스
- **기술**: PostgreSQL
- **고가용성**: Master-Replica 구성
- **백업**: 자동 일일 백업

### 4. 파일 스토리지
- **임시**: 로컬 파일 시스템
- **영구**: AWS S3 (또는 동등한 서비스)
- **CDN**: CloudFront, Cloudflare 등

### 5. 외부 서비스
- **AI 서비스**: Google Speech-to-Text, AWS Transcribe
- **결제**: 토스페이먼츠, 이니시스
- **모니터링**: Sentry, DataDog

---

## 🔄 데이터 흐름

### 영상 업로드 및 자막 생성

```
1. 사용자 → 프론트엔드
   ↓
2. 프론트엔드 → Nginx
   ↓
3. Nginx → API Server
   ↓
4. API Server → Local Storage (임시)
   ↓
5. API Server → PostgreSQL (메타데이터 저장)
   ↓
6. API Server → 크레딧 예약
   ↓
7. 작업 큐에 추가
   ↓
8. AI 서비스 호출 (음성 인식)
   ↓
9. AI 서비스 호출 (번역)
   ↓
10. 결과 저장 → PostgreSQL
   ↓
11. 파일 이동 → S3
   ↓
12. 크레딧 확정 차감
   ↓
13. 사용자에게 결과 전달
```

---

## 🔐 보안 계층

### 1. 네트워크 보안
- HTTPS 강제 (TLS 1.2+)
- 방화벽 설정
- DDoS 방어

### 2. 애플리케이션 보안
- JWT 인증
- Rate Limiting
- 입력 검증
- XSS/CSRF 방어

### 3. 데이터 보안
- 데이터베이스 암호화
- 파일 암호화 (선택사항)
- 백업 암호화

### 4. 인프라 보안
- SSH 키 인증
- 최소 권한 원칙
- 정기적인 보안 업데이트

---

## 📊 모니터링 및 로깅

### 모니터링 스택

```
┌─────────────┐
│  Prometheus  │  ← 메트릭 수집
└──────┬──────┘
       │
┌──────▼──────┐
│  Grafana    │  ← 대시보드
└─────────────┘

┌─────────────┐
│   ELK Stack │  ← 로그 수집 및 분석
│ (Elasticsearch,│
│  Logstash,  │
│  Kibana)    │
└─────────────┘

┌─────────────┐
│   Sentry    │  ← 에러 추적
└─────────────┘
```

### 주요 메트릭

**시스템:**
- CPU, Memory, Disk, Network

**애플리케이션:**
- API 응답 시간
- 에러율
- 요청 수
- 동시 연결 수

**비즈니스:**
- DAU/MAU
- 작업 생성 수
- 크레딧 사용량
- 수익

---

## 🚀 확장성

### 수평 확장

1. **API 서버**
   - 로드 밸런서 뒤에 여러 인스턴스
   - 상태 비저장(Stateless) 설계

2. **데이터베이스**
   - 읽기 전용 복제본
   - 샤딩 (필요 시)

3. **파일 스토리지**
   - S3 자동 확장
   - CDN으로 트래픽 분산

### 수직 확장

- 서버 사양 업그레이드
- 데이터베이스 최적화
- 캐싱 도입 (Redis)

---

## 💰 비용 최적화

### 1. 리소스 최적화
- Auto Scaling 설정
- 사용하지 않는 리소스 제거
- 예약 인스턴스 활용

### 2. 스토리지 최적화
- 자동 삭제 정책
- S3 라이프사이클 정책
- CDN 캐싱

### 3. 데이터베이스 최적화
- 인덱스 최적화
- 쿼리 최적화
- 연결 풀 튜닝

---

## 📋 체크리스트

프로덕션 배포 전:

- [ ] 인프라 구축 완료
- [ ] 데이터베이스 설정 완료
- [ ] 파일 스토리지 설정 완료
- [ ] SSL 인증서 설정 완료
- [ ] 모니터링 설정 완료
- [ ] 백업 설정 완료
- [ ] 로깅 설정 완료
- [ ] 보안 설정 완료
- [ ] 장애 대응 계획 수립
- [ ] 운영 매뉴얼 작성

---

**작성일**: 2025년 1월

