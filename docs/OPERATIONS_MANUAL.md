# AX2 Caption ìš´ì˜ ë§¤ë‰´ì–¼

ì¼ìƒì ì¸ ìš´ì˜ ë° ìœ ì§€ë³´ìˆ˜ë¥¼ ìœ„í•œ ë§¤ë‰´ì–¼ì…ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ì¼ìƒ ìš´ì˜](#1-ì¼ìƒ-ìš´ì˜)
2. [ëª¨ë‹ˆí„°ë§](#2-ëª¨ë‹ˆí„°ë§)
3. [ë°±ì—… ë° ë³µêµ¬](#3-ë°±ì—…-ë°-ë³µêµ¬)
4. [ì¥ì•  ëŒ€ì‘](#4-ì¥ì• -ëŒ€ì‘)
5. [ì—…ë°ì´íŠ¸ ë° ë°°í¬](#5-ì—…ë°ì´íŠ¸-ë°-ë°°í¬)

---

## 1. ì¼ìƒ ìš´ì˜

### 1.1 ì„œë²„ ìƒíƒœ í™•ì¸

```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ
pm2 status
pm2 logs ax2-caption-api --lines 50

# ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ
sudo systemctl status postgresql
psql -U ax2_caption -d ax2_caption -c "SELECT COUNT(*) FROM users;"

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
df -h
du -sh /var/www/ax2-caption/storage/*

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
free -h
```

### 1.2 ë¡œê·¸ í™•ì¸

```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
tail -f logs/$(date +%Y-%m-%d)-error.log
tail -f logs/$(date +%Y-%m-%d)-info.log

# PM2 ë¡œê·¸
pm2 logs ax2-caption-api

# ì‹œìŠ¤í…œ ë¡œê·¸
journalctl -u nginx -f
```

### 1.3 ì •ê¸° ì‘ì—…

**ë§¤ì¼:**
- [ ] ì„œë²„ ìƒíƒœ í™•ì¸
- [ ] ì—ëŸ¬ ë¡œê·¸ í™•ì¸
- [ ] ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸

**ë§¤ì£¼:**
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… í™•ì¸
- [ ] ë¡œê·¸ íŒŒì¼ ì •ë¦¬
- [ ] ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê²€í† 

**ë§¤ì›”:**
- [ ] ë³´ì•ˆ ì—…ë°ì´íŠ¸
- [ ] ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ ê²€í† 
- [ ] ìš©ëŸ‰ ê³„íš ê²€í† 

---

## 2. ëª¨ë‹ˆí„°ë§

### 2.1 ì£¼ìš” ë©”íŠ¸ë¦­

**ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­:**
- CPU ì‚¬ìš©ë¥ 
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
- ë””ìŠ¤í¬ ì‚¬ìš©ë¥ 
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½

**ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­:**
- API ì‘ë‹µ ì‹œê°„
- ì—ëŸ¬ìœ¨
- ë™ì‹œ ì‚¬ìš©ì ìˆ˜
- ì‘ì—… ì²˜ë¦¬ëŸ‰

**ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­:**
- ì¼ì¼ í™œì„± ì‚¬ìš©ì (DAU)
- ì‘ì—… ìƒì„± ìˆ˜
- í¬ë ˆë”§ ì‚¬ìš©ëŸ‰
- íŒŒì¼ ì—…ë¡œë“œ ìˆ˜

### 2.2 ì•Œë¦¼ ì„¤ì •

**ì„ê³„ê°’:**
- CPU ì‚¬ìš©ë¥  > 80%
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  > 85%
- ë””ìŠ¤í¬ ì‚¬ìš©ë¥  > 90%
- ì—ëŸ¬ìœ¨ > 5%
- ì‘ë‹µ ì‹œê°„ > 2ì´ˆ

**ì•Œë¦¼ ì±„ë„:**
- ì´ë©”ì¼
- Slack
- SMS (ê¸´ê¸‰)

---

## 3. ë°±ì—… ë° ë³µêµ¬

### 3.1 ë°±ì—… ì •ì±…

**ë°ì´í„°ë² ì´ìŠ¤:**
- ë¹ˆë„: ë§¤ì¼ ìƒˆë²½ 2ì‹œ
- ë³´ê´€: 30ì¼
- ìœ„ì¹˜: `/var/backups/ax2-caption/`

**íŒŒì¼ ìŠ¤í† ë¦¬ì§€:**
- ë¹ˆë„: ì£¼ 1íšŒ (ì¼ìš”ì¼)
- ë³´ê´€: 4ì£¼
- ìœ„ì¹˜: S3 ë˜ëŠ” ë³„ë„ ìŠ¤í† ë¦¬ì§€

### 3.2 ë°±ì—… í™•ì¸

```bash
# ë°±ì—… íŒŒì¼ ëª©ë¡
ls -lh /var/backups/ax2-caption/

# ìµœì‹  ë°±ì—… í™•ì¸
ls -lt /var/backups/ax2-caption/ | head -5
```

### 3.3 ë³µêµ¬ ì ˆì°¨

**ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬:**

```bash
# 1. ì„œë¹„ìŠ¤ ì¤‘ì§€
pm2 stop ax2-caption-api

# 2. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
pg_dump -U ax2_caption ax2_caption > backup_before_restore.sql

# 3. ë³µêµ¬ ì‹¤í–‰
psql -U ax2_caption ax2_caption < /var/backups/ax2-caption/db_backup_YYYYMMDD_HHMMSS.sql

# 4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
pm2 start ax2-caption-api
```

---

## 4. ì¥ì•  ëŒ€ì‘

### 4.1 ì¥ì•  ë“±ê¸‰

**P0 - Critical (ì¦‰ì‹œ ëŒ€ì‘)**
- ì„œë¹„ìŠ¤ ì™„ì „ ì¤‘ë‹¨
- ë°ì´í„° ì†ì‹¤
- ë³´ì•ˆ ì¹¨í•´

**P1 - High (1ì‹œê°„ ì´ë‚´)**
- ì£¼ìš” ê¸°ëŠ¥ ì¤‘ë‹¨
- ëŒ€ëŸ‰ ì‚¬ìš©ì ì˜í–¥

**P2 - Medium (4ì‹œê°„ ì´ë‚´)**
- ì¼ë¶€ ê¸°ëŠ¥ ì˜í–¥
- ì†Œìˆ˜ ì‚¬ìš©ì ì˜í–¥

**P3 - Low (24ì‹œê°„ ì´ë‚´)**
- ë¯¸ë¯¸í•œ ì˜í–¥
- ìš°íšŒ ê°€ëŠ¥

### 4.2 ì¥ì•  ëŒ€ì‘ ì ˆì°¨

1. **ì¥ì•  ë°œê²¬**
   - ëª¨ë‹ˆí„°ë§ ì•Œë¦¼
   - ì‚¬ìš©ì ì‹ ê³ 
   - ìë™ ê°ì§€

2. **ì´ˆê¸° ëŒ€ì‘**
   - ì¥ì•  ë“±ê¸‰ íŒë‹¨
   - ëŒ€ì‘íŒ€ ì†Œì§‘
   - ì‚¬ìš©ì ê³µì§€

3. **ì›ì¸ ë¶„ì„**
   - ë¡œê·¸ í™•ì¸
   - ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
   - ìµœê·¼ ë³€ê²½ì‚¬í•­ í™•ì¸

4. **ë³µêµ¬ ì¡°ì¹˜**
   - ì„ì‹œ ì¡°ì¹˜ (ë¡¤ë°± ë“±)
   - ê·¼ë³¸ ì›ì¸ í•´ê²°
   - ë³µêµ¬ í™•ì¸

5. **ì‚¬í›„ ì²˜ë¦¬**
   - Post-mortem ì‘ì„±
   - ê°œì„  ì¡°ì¹˜
   - ë¬¸ì„œí™”

### 4.3 ì¼ë°˜ì ì¸ ì¥ì•  ë° í•´ê²°

**ì„œë²„ ë‹¤ìš´:**
```bash
# ì„œë²„ ì¬ì‹œì‘
pm2 restart ax2-caption-api

# ìƒíƒœ í™•ì¸
pm2 status
```

**ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜:**
```bash
# PostgreSQL ìƒíƒœ í™•ì¸
sudo systemctl status postgresql

# ì¬ì‹œì‘
sudo systemctl restart postgresql

# ì—°ê²° í…ŒìŠ¤íŠ¸
psql -U ax2_caption -d ax2_caption -c "SELECT 1;"
```

**ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±:**
```bash
# ì‚¬ìš©ëŸ‰ í™•ì¸
df -h
du -sh /var/www/ax2-caption/storage/*

# ì˜¤ë˜ëœ íŒŒì¼ ì‚­ì œ
find /var/www/ax2-caption/storage -type f -mtime +30 -delete

# ë¡œê·¸ ì •ë¦¬
find /var/www/ax2-caption/backend/logs -type f -mtime +7 -delete
```

**ë©”ëª¨ë¦¬ ë¶€ì¡±:**
```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
free -h
pm2 monit

# ë¶ˆí•„ìš”í•œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
# ë˜ëŠ” ì„œë²„ ìŠ¤ì¼€ì¼ ì—…
```

---

## 5. ì—…ë°ì´íŠ¸ ë° ë°°í¬

### 5.1 ë°°í¬ ì ˆì°¨

```bash
# 1. ì½”ë“œ ì—…ë°ì´íŠ¸
cd /var/www/ax2-caption/backend
git pull origin main

# 2. ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
npm install --production

# 3. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (í•„ìš” ì‹œ)
npm run init-db  # ë˜ëŠ” ë³„ë„ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

# 4. í…ŒìŠ¤íŠ¸
npm test  # (í…ŒìŠ¤íŠ¸ê°€ ìˆëŠ” ê²½ìš°)

# 5. ì„œë²„ ì¬ì‹œì‘
pm2 restart ax2-caption-api

# 6. ìƒíƒœ í™•ì¸
pm2 logs ax2-caption-api --lines 50
```

### 5.2 ë¡¤ë°± ì ˆì°¨

```bash
# 1. ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µêµ¬
cd /var/www/ax2-caption/backend
git checkout <previous-version-tag>

# 2. ì„œë²„ ì¬ì‹œì‘
pm2 restart ax2-caption-api

# 3. ìƒíƒœ í™•ì¸
pm2 logs ax2-caption-api
```

### 5.3 ë¬´ì¤‘ë‹¨ ë°°í¬ (Blue-Green)

```bash
# 1. ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ (ë‹¤ë¥¸ í¬íŠ¸)
pm2 start server.js --name ax2-caption-api-new -- --port 3001

# 2. í—¬ìŠ¤ ì²´í¬
curl http://localhost:3001/health

# 3. Nginx ì„¤ì • ë³€ê²½ (ìƒˆ í¬íŠ¸ë¡œ)
# 4. Nginx ì¬ì‹œì‘
sudo systemctl reload nginx

# 5. ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ì¢…ë£Œ
pm2 stop ax2-caption-api
pm2 delete ax2-caption-api

# 6. ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ì´ë¦„ ë³€ê²½
pm2 restart ax2-caption-api-new --update-env --name ax2-caption-api
```

---

## ğŸ“ ì—°ë½ì²˜

**ê°œë°œíŒ€:**
- ì´ë©”ì¼: dev@ax2caption.com
- Slack: #ax2-caption-dev

**ìš´ì˜íŒ€:**
- ì´ë©”ì¼: ops@ax2caption.com
- ê¸´ê¸‰: 010-XXXX-XXXX

**ì™¸ë¶€ ì—…ì²´:**
- í´ë¼ìš°ë“œ ì œê³µì: AWS Support
- PGì‚¬: í† ìŠ¤í˜ì´ë¨¼ì¸  ê³ ê°ì„¼í„°

---

**ì‘ì„±ì¼**: 2025ë…„ 1ì›”  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025ë…„ 1ì›”

